(function(z){function J(p,n,E){function F(a,c){a=a.cloneNode(c);a.removeAttribute("id");return a}function D(){var a=0;l=[];q(["thead","tbody","tfoot"],function(c){var e=n.select("> "+c+" tr",p);q(e,function(g,f){f+=a;q(n.select("> td, > th",g),function(d,h){var m,w,I,G;if(l[f])for(;l[f][h];)h++;I=b(d,"rowspan");G=b(d,"colspan");for(w=f;w<f+I;w++){l[w]||(l[w]=[]);for(m=h;m<h+G;m++)l[w][m]={part:c,real:w==f&&m==h,elm:d,rowspan:I,colspan:G}}})});a+=e.length})}function B(a,c){var e;if(e=l[c])return e[a]}
function b(a,c){return parseInt(a.getAttribute(c)||1)}function o(a){return n.hasClass(a.elm,"mceSelected")||a==C}function t(){var a=[];q(p.rows,function(c){q(c.cells,function(e){if(n.hasClass(e,"mceSelected")||e==C.elm){a.push(c);return false}})});return a}function u(a){var c;z.walk(a,function(e){var g;if(e.nodeType==3){q(n.getParents(e.parentNode,null,a).reverse(),function(f){f=F(f,false);if(c)g&&g.appendChild(f);else c=g=f;g=f});if(g)g.innerHTML=z.isIE?"&nbsp;":'<br data-mce-bogus="1" />';return false}},
"childNodes");a=F(a,false);a.rowSpan=a.colSpan=1;if(c)a.appendChild(c);else if(!z.isIE)a.innerHTML='<br data-mce-bogus="1" />';return a}function A(){var a=n.createRng();q(n.select("tr",p),function(c){c.cells.length==0&&n.remove(c)});if(n.select("tr",p).length==0){a.setStartAfter(p);a.setEndAfter(p);E.setRng(a);n.remove(p)}else{q(n.select("thead,tbody,tfoot",p),function(c){c.rows.length==0&&n.remove(c)});D();if(row=l[Math.min(l.length-1,s.y)]){E.select(row[Math.min(row.length-1,s.x)].elm,true);E.collapse(true)}}}
function H(a,c,e,g){var f,d,h,m,w;f=l[c][a].elm.parentNode;for(h=1;h<=e;h++)if(f=n.getNext(f,"tr")){for(d=a;d>=0;d--){w=l[c+h][d].elm;if(w.parentNode==f){for(m=1;m<=g;m++)n.insertAfter(u(w),w);break}}if(d==-1)for(m=1;m<=g;m++)f.insertBefore(u(f.cells[0]),f.cells[0])}}function r(){q(l,function(a,c){q(a,function(e,g){var f,d,h;if(o(e)){e=e.elm;f=b(e,"colspan");d=b(e,"rowspan");if(f>1||d>1){e.colSpan=e.rowSpan=1;for(h=0;h<f-1;h++)n.insertAfter(u(e),e);H(g,c,d-1,f)}}})})}function k(a){var c;q(l,function(e,
g){q(e,function(f,d){if(f.elm==a){c={x:d,y:g};return false}});return!c});return c}function j(){var a,c;a=c=0;q(l,function(e,g){q(e,function(f,d){var h,m;if(o(f)){f=l[g][d];if(d>a)a=d;if(g>c)c=g;if(f.real){h=f.colspan-1;m=f.rowspan-1;if(h)if(d+h>a)a=d+h;if(m)if(g+m>c)c=g+m}}})});return{x:a,y:c}}var l,s,v,C;D();if(C=n.getParent(E.getStart(),"th,td")){s=k(C);v=j();C=B(s.x,s.y)}z.extend(this,{deleteTable:function(){var a=n.createRng();a.setStartAfter(p);a.setEndAfter(p);E.setRng(a);n.remove(p)},split:r,
merge:function(a,c,e){var g,f,d,h,m;if(a){pos=k(a);g=pos.x;a=pos.y;c=g+(c-1);e=a+(e-1)}else{g=s.x;a=s.y;c=v.x;e=v.y}h=B(g,a);f=B(c,e);if(h&&f&&h.part==f.part){r();D();h=B(g,a).elm;h.colSpan=c-g+1;h.rowSpan=e-a+1;for(d=a;d<=e;d++)for(f=g;f<=c;f++){a=l[d][f].elm;if(a!=h){m=z.grep(a.childNodes);q(m,function(w,I){if(w.nodeName!="BR"||I!=m.length-1)h.appendChild(w)});n.remove(a)}}A()}},insertRow:function(a){var c,e,g,f,d,h,m;q(l,function(w,I){q(w,function(G){if(o(G)){G=G.elm;d=G.parentNode;h=F(d,false);
c=I;if(a)return false}});if(a)return!c});for(f=0;f<l[0].length;f++){e=l[c][f].elm;if(e!=g){if(a){if(c>0&&l[c-1][f]){m=l[c-1][f].elm;rowSpan=b(m,"rowspan");if(rowSpan>1){m.rowSpan=rowSpan+1;continue}}}else{rowSpan=b(e,"rowspan");if(rowSpan>1){e.rowSpan=rowSpan+1;continue}}g=u(e);g.colSpan=e.colSpan;h.appendChild(g);g=e}}if(h.hasChildNodes())a?d.parentNode.insertBefore(h,d):n.insertAfter(h,d)},insertCol:function(a){var c,e;q(l,function(g){q(g,function(f,d){if(o(f)){c=d;if(a)return false}});if(a)return!c});
q(l,function(g,f){var d=g[c].elm,h,m;if(d!=e){m=b(d,"colspan");h=b(d,"rowspan");if(m==1){a?d.parentNode.insertBefore(u(d),d):n.insertAfter(u(d),d);H(c,f,h-1,m)}else d.colSpan++;e=d}})},deleteCols:function(){var a=[];q(l,function(c){q(c,function(e,g){if(o(e)&&z.inArray(a,g)===-1){q(l,function(f){f=f[g].elm;var d;d=b(f,"colspan");if(d>1)f.colSpan=d-1;else n.remove(f)});a.push(g)}})});A()},deleteRows:function(){function a(e){var g,f;n.getNext(e,"tr");q(e.cells,function(d){var h=b(d,"rowspan");if(h>1){d.rowSpan=
h-1;g=k(d);H(g.x,g.y,1,1)}});g=k(e.cells[0]);q(l[g.y],function(d){var h;d=d.elm;if(d!=f){h=b(d,"rowspan");if(h<=1)n.remove(d);else d.rowSpan=h-1;f=d}})}var c;c=t();q(c.reverse(),function(e){a(e)});A()},cutRows:function(){var a=t();n.remove(a);A();return a},copyRows:function(){var a=t();q(a,function(c,e){a[e]=F(c,true)});return a},pasteRows:function(a,c){var e=t(),g=e[c?0:e.length-1],f=g.cells.length;q(l,function(d){var h;f=0;q(d,function(m){if(m.real)f+=m.colspan;if(m.elm.parentNode==g)h=1});if(h)return false});
c||a.reverse();q(a,function(d){var h=d.cells.length,m;for(i=0;i<h;i++){m=d.cells[i];m.colSpan=m.rowSpan=1}for(i=h;i<f;i++)d.appendChild(u(d.cells[h-1]));for(i=f;i<h;i++)n.remove(d.cells[i]);c?g.parentNode.insertBefore(d,g):n.insertAfter(d,g)})},getPos:k,setStartCell:function(a){s=k(a)},setEndCell:function(a){var c,e,g,f,d,h,m;v=k(a);if(s&&v){c=Math.min(s.x,v.x);e=Math.min(s.y,v.y);g=Math.max(s.x,v.x);f=Math.max(s.y,v.y);d=g;h=f;for(y=e;y<=h;y++){a=l[y][c];if(!a.real)if(c-(a.colspan-1)<c)c-=a.colspan-
1}for(x=c;x<=d;x++){a=l[e][x];if(!a.real)if(e-(a.rowspan-1)<e)e-=a.rowspan-1}for(y=e;y<=f;y++)for(x=c;x<=g;x++){a=l[y][x];if(a.real){m=a.colspan-1;a=a.rowspan-1;if(m)if(x+m>d)d=x+m;if(a)if(y+a>h)h=y+a}}n.removeClass(n.select("td.mceSelected,th.mceSelected"),"mceSelected");for(y=e;y<=h;y++)for(x=c;x<=d;x++)n.addClass(l[y][x].elm,"mceSelected")}}})}var q=z.each;z.create("tinymce.plugins.TablePlugin",{init:function(p,n){function E(b){var o=p.selection;if(b=p.dom.getParent(b||o.getNode(),"table"))return new J(b,
p.dom,o)}function F(){p.getBody().style.webkitUserSelect="";p.dom.removeClass(p.dom.select("td.mceSelected,th.mceSelected"),"mceSelected")}var D,B;q([["table","table.desc","mceInsertTable",true],["delete_table","table.del","mceTableDelete"],["delete_col","table.delete_col_desc","mceTableDeleteCol"],["delete_row","table.delete_row_desc","mceTableDeleteRow"],["col_after","table.col_after_desc","mceTableInsertColAfter"],["col_before","table.col_before_desc","mceTableInsertColBefore"],["row_after","table.row_after_desc",
"mceTableInsertRowAfter"],["row_before","table.row_before_desc","mceTableInsertRowBefore"],["row_props","table.row_desc","mceTableRowProps",true],["cell_props","table.cell_desc","mceTableCellProps",true],["split_cells","table.split_cells_desc","mceTableSplitCells",true],["merge_cells","table.merge_cells_desc","mceTableMergeCells",true]],function(b){p.addButton(b[0],{title:b[1],cmd:b[2],ui:b[3]})});z.isIE||p.onClick.add(function(b,o){o=o.target;o.nodeName==="TABLE"&&b.selection.select(o)});p.onNodeChange.add(function(b,
o,t){t=b.selection.getStart();b=b.dom.getParent(t,"td,th,caption");o.setActive("table",t.nodeName==="TABLE"||!!b);if(b&&b.nodeName==="CAPTION")b=0;o.setDisabled("delete_table",!b);o.setDisabled("delete_col",!b);o.setDisabled("delete_table",!b);o.setDisabled("delete_row",!b);o.setDisabled("col_after",!b);o.setDisabled("col_before",!b);o.setDisabled("row_after",!b);o.setDisabled("row_before",!b);o.setDisabled("row_props",!b);o.setDisabled("cell_props",!b);o.setDisabled("split_cells",!b);o.setDisabled("merge_cells",
!b)});p.onInit.add(function(b){var o,t,u=b.dom,A;D=b.windowManager;b.onMouseDown.add(function(r,k){if(k.button!=2){F();t=u.getParent(k.target,"td,th");o=u.getParent(t,"table")}});u.bind(b.getDoc(),"mouseover",function(r){var k,j=r.target;if(t&&(A||j!=t)&&(j.nodeName=="TD"||j.nodeName=="TH")){k=u.getParent(j,"table");if(k==o){if(!A){A=E(k);A.setStartCell(t);b.getBody().style.webkitUserSelect="none"}A.setEndCell(j)}k=b.selection.getSel();k.removeAllRanges?k.removeAllRanges():k.empty();r.preventDefault()}});
b.onMouseUp.add(function(r){var k,j=r.selection,l;j.getSel();var s,v;if(t){if(A)r.getBody().style.webkitUserSelect="";var C=function(a,c){var e=new z.dom.TreeWalker(a,a);do{if(a.nodeType==3&&z.trim(a.nodeValue).length!=0){c?k.setStart(a,0):k.setEnd(a,a.nodeValue.length);break}if(a.nodeName=="BR"){c?k.setStartBefore(a):k.setEndBefore(a);break}}while(a=c?e.next():e.prev())};l=u.select("td.mceSelected,th.mceSelected");if(l.length>0){k=u.createRng();s=l[0];C(s,1);l=new z.dom.TreeWalker(s,u.getParent(l[0],
"table"));do if(s.nodeName=="TD"||s.nodeName=="TH"){if(!u.hasClass(s,"mceSelected"))break;v=s}while(s=l.next());C(v);j.setRng(k)}r.nodeChanged();t=A=o=null}});b.onKeyUp.add(function(){F()});b&&b.plugins.contextmenu&&b.plugins.contextmenu.onContextMenu.add(function(r,k,j){r=b.selection.getNode()||b.getBody();if(b.dom.getParent(j,"td")||b.dom.getParent(j,"th")||b.dom.select("td.mceSelected,th.mceSelected").length){k.removeAll();if(r.nodeName=="A"&&!b.dom.getAttrib(r,"name")){k.add({title:"advanced.link_desc",
icon:"link",cmd:b.plugins.advlink?"mceAdvLink":"mceLink",ui:true});k.add({title:"advanced.unlink_desc",icon:"unlink",cmd:"UnLink"});k.addSeparator()}if(r.nodeName=="IMG"&&r.className.indexOf("mceItem")==-1){k.add({title:"advanced.image_desc",icon:"image",cmd:b.plugins.advimage?"mceAdvImage":"mceImage",ui:true});k.addSeparator()}k.add({title:"table.desc",icon:"table",cmd:"mceInsertTable",value:{action:"insert"}});k.add({title:"table.props_desc",icon:"table_props",cmd:"mceInsertTable"});k.add({title:"table.del",
icon:"delete_table",cmd:"mceTableDelete"});k.addSeparator();j=k.addMenu({title:"table.cell"});j.add({title:"table.cell_desc",icon:"cell_props",cmd:"mceTableCellProps"});j.add({title:"table.split_cells_desc",icon:"split_cells",cmd:"mceTableSplitCells"});j.add({title:"table.merge_cells_desc",icon:"merge_cells",cmd:"mceTableMergeCells"});j=k.addMenu({title:"table.row"});j.add({title:"table.row_desc",icon:"row_props",cmd:"mceTableRowProps"});j.add({title:"table.row_before_desc",icon:"row_before",cmd:"mceTableInsertRowBefore"});
j.add({title:"table.row_after_desc",icon:"row_after",cmd:"mceTableInsertRowAfter"});j.add({title:"table.delete_row_desc",icon:"delete_row",cmd:"mceTableDeleteRow"});j.addSeparator();j.add({title:"table.cut_row_desc",icon:"cut",cmd:"mceTableCutRow"});j.add({title:"table.copy_row_desc",icon:"copy",cmd:"mceTableCopyRow"});j.add({title:"table.paste_row_before_desc",icon:"paste",cmd:"mceTablePasteRowBefore"}).setDisabled(!B);j.add({title:"table.paste_row_after_desc",icon:"paste",cmd:"mceTablePasteRowAfter"}).setDisabled(!B);
j=k.addMenu({title:"table.col"});j.add({title:"table.col_before_desc",icon:"col_before",cmd:"mceTableInsertColBefore"});j.add({title:"table.col_after_desc",icon:"col_after",cmd:"mceTableInsertColAfter"});j.add({title:"table.delete_col_desc",icon:"delete_col",cmd:"mceTableDeleteCol"})}else k.add({title:"table.desc",icon:"table",cmd:"mceInsertTable"})});if(!z.isIE){var H=function(){var r;for(r=b.getBody().lastChild;r&&r.nodeType==3&&!r.nodeValue.length;r=r.previousSibling);r&&r.nodeName=="TABLE"&&b.dom.add(b.getBody(),
"p",null,'<br mce_bogus="1" />')};z.isGecko&&b.onKeyDown.add(function(r,k){var j,l,s=r.dom;if(k.keyCode==37||k.keyCode==38){j=r.selection.getRng();if((l=s.getParent(j.startContainer,"table"))&&r.getBody().firstChild==l){var v=j,C=l.ownerDocument;j=C.createRange();j.setStartBefore(l);j.setEnd(v.endContainer,v.endOffset);v=C.createElement("body");v.appendChild(j.cloneContents());if(v.innerHTML.replace(/<(br|img|object|embed|input|textarea)[^>]*>/gi,"-").replace(/<[^>]+>/g,"").length==0){j=s.createRng();
j.setStartBefore(l);j.setEndBefore(l);r.selection.setRng(j);k.preventDefault()}}}});b.onKeyUp.add(H);b.onSetContent.add(H);b.onVisualAid.add(H);b.onPreProcess.add(function(r,k){var j=k.node.lastChild;j&&j.childNodes.length==1&&j.firstChild.nodeName=="BR"&&r.dom.remove(j)});H()}});q({mceTableSplitCells:function(b){b.split()},mceTableMergeCells:function(b){var o,t,u;if(u=p.dom.getParent(p.selection.getNode(),"th,td")){o=u.rowSpan;t=u.colSpan}p.dom.select("td.mceSelected,th.mceSelected").length?b.merge():
D.open({url:n+"/merge_cells.htm",width:240+parseInt(p.getLang("table.merge_cells_delta_width",0)),height:110+parseInt(p.getLang("table.merge_cells_delta_height",0)),inline:1},{rows:o,cols:t,onaction:function(A){b.merge(u,A.cols,A.rows)},plugin_url:n})},mceTableInsertRowBefore:function(b){b.insertRow(true)},mceTableInsertRowAfter:function(b){b.insertRow()},mceTableInsertColBefore:function(b){b.insertCol(true)},mceTableInsertColAfter:function(b){b.insertCol()},mceTableDeleteCol:function(b){b.deleteCols()},
mceTableDeleteRow:function(b){b.deleteRows()},mceTableCutRow:function(b){B=b.cutRows()},mceTableCopyRow:function(b){B=b.copyRows()},mceTablePasteRowBefore:function(b){b.pasteRows(B,true)},mceTablePasteRowAfter:function(b){b.pasteRows(B)},mceTableDelete:function(b){b.deleteTable()}},function(b,o){p.addCommand(o,function(){var t=E();if(t){b(t);p.execCommand("mceRepaint");F()}})});q({mceInsertTable:function(b){D.open({url:n+"/table.htm",width:400+parseInt(p.getLang("table.table_delta_width",0)),height:320+
parseInt(p.getLang("table.table_delta_height",0)),inline:1},{plugin_url:n,action:b?b.action:0})},mceTableRowProps:function(){D.open({url:n+"/row.htm",width:400+parseInt(p.getLang("table.rowprops_delta_width",0)),height:295+parseInt(p.getLang("table.rowprops_delta_height",0)),inline:1},{plugin_url:n})},mceTableCellProps:function(){D.open({url:n+"/cell.htm",width:400+parseInt(p.getLang("table.cellprops_delta_width",0)),height:295+parseInt(p.getLang("table.cellprops_delta_height",0)),inline:1},{plugin_url:n})}},
function(b,o){p.addCommand(o,function(t,u){b(u)})})}});z.PluginManager.add("table",z.plugins.TablePlugin)})(tinymce);
