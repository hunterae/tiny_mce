(function(){function o(a,i){return a.getParam(i,w[i])}var s=tinymce.each,w={paste_auto_cleanup_on_paste:true,paste_block_drop:false,paste_retain_style_properties:"none",paste_strip_class_attributes:"mso",paste_remove_spans:false,paste_remove_styles:false,paste_remove_styles_if_webkit:true,paste_convert_middot_lists:true,paste_convert_headers_to_strong:false,paste_dialog_width:"450",paste_dialog_height:"400",paste_text_use_dialog:false,paste_text_sticky:false,paste_text_notifyalways:false,paste_text_linebreaktype:"p",
paste_text_replacements:[[/\u2026/g,"..."],[/[\x93\x94\u201c\u201d]/g,'"'],[/[\x60\x91\x92\u2018\u2019]/g,"'"]]};tinymce.create("tinymce.plugins.PastePlugin",{init:function(a,i){function f(c,d){var n=a.dom,e;b.onPreProcess.dispatch(b,c);c.node=n.create("div",0,c.content);if(tinymce.isGecko){e=a.selection.getRng(true);if(e.startContainer==e.endContainer&&e.startContainer.nodeType==3){e=n.select("p,h1,h2,h3,h4,h5,h6,pre",c.node);e.length==1&&n.remove(e.reverse(),true)}}b.onPostProcess.dispatch(b,c);
c.content=a.serializer.serialize(c.node,{getInner:1});if(!d&&a.pasteAsPlainText){b._insertPlainText(a,n,c.content);if(!o(a,"paste_text_sticky")){a.pasteAsPlainText=false;a.controlManager.setActive("pastetext",false)}}else b._insert(c.content)}function h(c){var d,n,e,q=a.selection,g=a.dom;e=a.getBody();if(a.pasteAsPlainText&&(c.clipboardData||g.doc.dataTransfer)){c.preventDefault();f({content:(c.clipboardData||g.doc.dataTransfer).getData("Text").replace(/\r?\n/g,"<br />")})}else if(!g.get("_mcePaste")){d=
g.add(e,"div",{id:"_mcePaste","class":"mcePaste"},'\ufeff<br data-mce-bogus="1">');e=e!=a.getDoc().body?g.getPos(a.selection.getStart(),e).y:e.scrollTop+g.getViewPort().y;g.setStyles(d,{position:"absolute",left:-1E4,top:e,width:1,height:1,overflow:"hidden"});if(tinymce.isIE){e=g.doc.body.createTextRange();e.moveToElementText(d);e.execCommand("Paste");g.remove(d);if(d.innerHTML==="\ufeff"){a.execCommand("mcePasteWord");c.preventDefault()}else{f({content:d.innerHTML});return tinymce.dom.Event.cancel(c)}}else{var k=
function(p){p.preventDefault()};g.bind(a.getDoc(),"mousedown",k);g.bind(a.getDoc(),"keydown",k);n=a.selection.getRng();d=d.firstChild;e=a.getDoc().createRange();e.setStart(d,0);e.setEnd(d,1);q.setRng(e);window.setTimeout(function(){var p="",l=g.select("div.mcePaste");s(l,function(j){var m=j.firstChild;m&&m.nodeName=="DIV"&&m.style.marginTop&&m.style.backgroundColor&&g.remove(m,1);s(g.select("span.Apple-style-span",j),function(r){g.remove(r,1)});s(g.select("br[data-mce-bogus]",j),function(r){g.remove(r)});
if(j.parentNode.className!="mcePaste")p+=j.innerHTML});s(g.select("div.mcePaste"),function(j){g.remove(j)});n&&q.setRng(n);f({content:p});g.unbind(a.getDoc(),"mousedown",k);g.unbind(a.getDoc(),"keydown",k)},0)}}}var b=this;b.editor=a;b.url=i;b.onPreProcess=new tinymce.util.Dispatcher(b);b.onPostProcess=new tinymce.util.Dispatcher(b);b.onPreProcess.add(b._preProcess);b.onPostProcess.add(b._postProcess);b.onPreProcess.add(function(c,d){a.execCallback("paste_preprocess",c,d)});b.onPostProcess.add(function(c,
d){a.execCallback("paste_postprocess",c,d)});a.pasteAsPlainText=false;a.addCommand("mceInsertClipboardContent",function(c,d){f(d,true)});o(a,"paste_text_use_dialog")||a.addCommand("mcePasteText",function(){var c=tinymce.util.Cookie;a.pasteAsPlainText=!a.pasteAsPlainText;a.controlManager.setActive("pastetext",a.pasteAsPlainText);if(a.pasteAsPlainText&&!c.get("tinymcePasteText")){o(a,"paste_text_sticky");a.windowManager.alert(a.translate("paste.plaintext_mode_sticky"));o(a,"paste_text_notifyalways")||
c.set("tinymcePasteText","1",new Date((new Date).getFullYear()+1,12,31))}});a.addButton("pastetext",{title:"paste.paste_text_desc",cmd:"mcePasteText"});a.addButton("selectall",{title:"paste.selectall_desc",cmd:"selectall"});if(o(a,"paste_auto_cleanup_on_paste"))tinymce.isOpera||/Firefox\/2/.test(navigator.userAgent)?a.onKeyDown.add(function(c,d){if((tinymce.isMac?d.metaKey:d.ctrlKey)&&d.keyCode==86||d.shiftKey&&d.keyCode==45)h(d)}):a.onPaste.addToTop(function(c,d){return h(d)});o(a,"paste_block_drop")&&
a.onInit.add(function(){a.dom.bind(a.getBody(),["dragend","dragover","draggesture","dragdrop","drop","drag"],function(c){c.preventDefault();c.stopPropagation();return false})});b._legacySupport()},getInfo:function(){return{longname:"Paste text/word",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/paste",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_preProcess:function(a,i){function f(g){s(g,function(k){b=
k.constructor==RegExp?b.replace(k,""):b.replace(k[0],k[1])})}var h=this.editor,b=i.content,c=tinymce.grep,d=tinymce.explode,n=tinymce.trim,e,q;if(/class="?Mso|style="[^"]*\bmso-|w:WordDocument/i.test(b)||i.wordContent){i.wordContent=true;f([/^\s*(&nbsp;)+/gi,/(&nbsp;|<br[^>]*>)+\s*$/gi]);if(o(h,"paste_convert_headers_to_strong"))b=b.replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1</strong></p>");o(h,"paste_convert_middot_lists")&&f([[/<!--\[if !supportLists\]--\>/gi,"$&__MCE_ITEM__"],
[/(<span[^>]+(?:mso-list:|:\s*symbol)[^>]+>)/gi,"$1__MCE_ITEM__"],[/(<p[^>]+(?:MsoListParagraph)[^>]+>)/gi,"$1__MCE_ITEM__"]]);f([/<!--[\s\S]+?--\>/gi,/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,[/<(\/?)s>/gi,"<$1strike>"],[/&nbsp;/gi,"\u00a0"]]);do{e=b.length;b=b.replace(/(<[a-z][^>]*\s)(?:id|name|language|type|on\w+|\w+:\w+)=(?:"[^"]*"|\w+)\s?/gi,"$1")}while(e!=b.length);if(o(h,"paste_retain_style_properties").replace(/^none$/i,"").length==
0)b=b.replace(/<\/?span[^>]*>/gi,"");else f([[/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,function(g,k){return k.length>0?k.replace(/./," ").slice(Math.floor(k.length/2)).split("").join("\u00a0"):""}],[/(<[a-z][^>]*)\sstyle="([^"]*)"/gi,function(g,k,p){var l=[],j=0;g=d(n(p).replace(/&quot;/gi,"'"),";");s(g,function(m){function r(v){return v+(v!=="0"&&/\d$/.test(v))?"px":""}var t,u=d(m,":");if(u.length==2){m=u[0].toLowerCase();t=u[1].toLowerCase();switch(m){case "mso-padding-alt":case "mso-padding-top-alt":case "mso-padding-right-alt":case "mso-padding-bottom-alt":case "mso-padding-left-alt":case "mso-margin-alt":case "mso-margin-top-alt":case "mso-margin-right-alt":case "mso-margin-bottom-alt":case "mso-margin-left-alt":case "mso-table-layout-alt":case "mso-height":case "mso-width":case "mso-vertical-align-alt":l[j++]=
m.replace(/^mso-|-alt$/g,"")+":"+r(t);return;case "horiz-align":l[j++]="text-align:"+t;return;case "vert-align":l[j++]="vertical-align:"+t;return;case "font-color":case "mso-foreground":l[j++]="color:"+t;return;case "mso-background":case "mso-highlight":l[j++]="background:"+t;return;case "mso-default-height":l[j++]="min-height:"+r(t);return;case "mso-default-width":l[j++]="min-width:"+r(t);return;case "mso-padding-between-alt":l[j++]="border-collapse:separate;border-spacing:"+r(t);return;case "text-line-through":if(t==
"single"||t=="double")l[j++]="text-decoration:line-through";return;case "mso-zero-height":if(t=="yes")l[j++]="display:none";return}/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?!align|decor|indent|trans)|top-bar|version|vnd|word-break)/.test(m)||(l[j++]=m+":"+u[1])}});return j>0?k+' style="'+l.join(";")+'"':k}]])}o(h,"paste_convert_headers_to_strong")&&f([[/<h[1-6][^>]*>/gi,"<p><strong>"],[/<\/h[1-6][^>]*>/gi,"</strong></p>"]]);
f([[/Version:[\d.]+\nStartHTML:\d+\nEndHTML:\d+\nStartFragment:\d+\nEndFragment:\d+/gi,""],[/<\/h[1-6][^>]*>/gi,"</strong></p>"]]);q=o(h,"paste_strip_class_attributes");if(q!=="none"){e=function(g,k){if(q==="all")return"";var p=c(d(k.replace(/^(["'])(.*)\1$/,"$2")," "),function(l){return/^(?!mso)/i.test(l)});return p.length?' class="'+p.join(" ")+'"':""};b=b.replace(/ class="([^"]+)"/gi,e);b=b.replace(/ class=([\-\w]+)/gi,e)}if(o(h,"paste_remove_spans"))b=b.replace(/<\/?span[^>]*>/gi,"");i.content=
b},_postProcess:function(a,i){var f=this.editor,h=f.dom,b;if(i.wordContent){s(h.select("a",i.node),function(c){if(!c.href||c.href.indexOf("#_Toc")!=-1)h.remove(c,1)});o(f,"paste_convert_middot_lists")&&this._convertLists(a,i);b=o(f,"paste_retain_style_properties");if(tinymce.is(b,"string")&&b!=="all"&&b!=="*"){b=tinymce.explode(b.replace(/^none$/i,""));s(h.select("*",i.node),function(c){var d={},n=0,e,q,g;if(b)for(e=0;e<b.length;e++){q=b[e];if(g=h.getStyle(c,q)){d[q]=g;n++}}h.setAttrib(c,"style",
"");if(b&&n>0)h.setStyles(c,d);else c.nodeName=="SPAN"&&!c.className&&h.remove(c,true)})}}if(o(f,"paste_remove_styles")||o(f,"paste_remove_styles_if_webkit")&&tinymce.isWebKit)s(h.select("*[style]",i.node),function(c){c.removeAttribute("style");c.removeAttribute("data-mce-style")});else tinymce.isWebKit&&s(h.select("*",i.node),function(c){c.removeAttribute("data-mce-style")})},_convertLists:function(a,i){var f=a.editor.dom,h,b,c=-1,d,n=[],e,q;s(f.select("p",i.node),function(g){var k,p="",l;for(k=
g.firstChild;k&&k.nodeType==3;k=k.nextSibling)p+=k.nodeValue;p=g.innerHTML.replace(/<\/?\w+[^>]*>/gi,"").replace(/&nbsp;/g,"\u00a0");if(/^(__MCE_ITEM__)+[\u2022\u00b7\u00a7\u00d8o]\s*\u00a0*/.test(p))l="ul";if(/^__MCE_ITEM__\s*\w+\.\s*\u00a0+/.test(p))l="ol";if(l){d=parseFloat(g.style.marginLeft||0);d>c&&n.push(d);if(!h||l!=e){h=f.create(l);f.insertAfter(h,g)}else if(d>c)h=b.appendChild(f.create(l));else if(d<c){k=tinymce.inArray(n,d);p=f.getParents(h.parentNode,l);h=p[p.length-1-k]||h}s(f.select("span",
g),function(j){var m=j.innerHTML.replace(/<\/?\w+[^>]*>/gi,"");if(l=="ul"&&/^[\u2022\u00b7\u00a7\u00d8o]/.test(m))f.remove(j);else/^[\s\S]*\w+\.(&nbsp;|\u00a0)*\s*/.test(m)&&f.remove(j)});k=g.innerHTML;k=l=="ul"?g.innerHTML.replace(/__MCE_ITEM__/g,"").replace(/^[\u2022\u00b7\u00a7\u00d8o]\s*(&nbsp;|\u00a0)+\s*/,""):g.innerHTML.replace(/__MCE_ITEM__/g,"").replace(/^\s*\w+\.(&nbsp;|\u00a0)+\s*/,"");b=h.appendChild(f.create("li",0,k));f.remove(g);c=d;e=l}else h=c=0});q=i.node.innerHTML;if(q.indexOf("__MCE_ITEM__")!=
-1)i.node.innerHTML=q.replace(/__MCE_ITEM__/g,"")},_insert:function(a,i){var f=this.editor,h=f.selection.getRng();!f.selection.isCollapsed()&&h.startContainer!=h.endContainer&&f.getDoc().execCommand("Delete",false,null);f.execCommand(tinymce.isGecko?"insertHTML":"mceInsertContent",false,a,{skip_undo:i})},_insertPlainText:function(a,i,f){function h(j){s(j,function(m){f=m.constructor==RegExp?f.replace(m,""):f.replace(m[0],m[1])})}var b,c,d,n,e,q,g,k=a.getWin(),p=a.getDoc(),l=a.selection;d=tinymce.is;
n=o(a,"paste_text_linebreaktype");e=o(a,"paste_text_replacements");if(typeof f==="string"&&f.length>0){/<(?:p|br|h[1-6]|ul|ol|dl|table|t[rdh]|div|blockquote|fieldset|pre|address|center)[^>]*>/i.test(f)?h([/[\n\r]+/g]):h([/\r+/g]);h([[/<\/(?:p|h[1-6]|ul|ol|dl|table|div|blockquote|fieldset|pre|address|center)>/gi,"\n\n"],[/<br[^>]*>|<\/tr>/gi,"\n"],[/<\/t[dh]>\s*<t[dh][^>]*>/gi,"\t"],/<[a-z!\/?][^>]*>/gi,[/&nbsp;/gi," "],[/(?:(?!\n)\s)*(\n+)(?:(?!\n)\s)*/gi,"$1"],[/\n{3,}/g,"\n\n"],/^\s+|\s+$/g]);f=
i.encode(f);l.isCollapsed()||p.execCommand("Delete",false,null);if(d(e,"array")||d(e,"array"))h(e);else d(e,"string")&&h(RegExp(e,"gi"));if(n=="none")h([[/\n+/g," "]]);else n=="br"?h([[/\n/g,"<br />"]]):h([/^\s+|\s+$/g,[/\n\n/g,"</p><p>"],[/\n/g,"<br />"]]);if((d=f.indexOf("</p><p>"))!=-1){n=f.lastIndexOf("</p><p>");b=l.getNode();e=[];do if(b.nodeType==1){if(b.nodeName=="TD"||b.nodeName=="BODY")break;e[e.length]=b}while(b=b.parentNode);if(e.length>0){q=f.substring(0,d);g="";b=0;for(c=e.length;b<c;b++){q+=
"</"+e[b].nodeName.toLowerCase()+">";g+="<"+e[e.length-b-1].nodeName.toLowerCase()+">"}f=d==n?q+g+f.substring(d+7):q+f.substring(d+4,n+4)+g+f.substring(n+7)}}a.execCommand("mceInsertRawHTML",false,f+'<span id="_plain_text_marker">&nbsp;</span>');window.setTimeout(function(){var j=i.get("_plain_text_marker"),m,r;l.select(j,false);p.execCommand("Delete",false,null);m=l.getStart();j=i.getViewPort(k);r=i.getPos(m).y;m=m.clientHeight;if(r<j.y||r+m>j.y+j.h)p.body.scrollTop=r<j.y?r:r-j.h+25},0)}},_legacySupport:function(){var a=
this,i=a.editor;i.addCommand("mcePasteWord",function(){i.windowManager.open({file:a.url+"/pasteword.htm",width:parseInt(o(i,"paste_dialog_width")),height:parseInt(o(i,"paste_dialog_height")),inline:1})});o(i,"paste_text_use_dialog")&&i.addCommand("mcePasteText",function(){i.windowManager.open({file:a.url+"/pastetext.htm",width:parseInt(o(i,"paste_dialog_width")),height:parseInt(o(i,"paste_dialog_height")),inline:1})});i.addButton("pasteword",{title:"paste.paste_word_desc",cmd:"mcePasteWord"})}});
tinymce.PluginManager.add("paste",tinymce.plugins.PastePlugin)})();
