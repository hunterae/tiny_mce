(function(){function p(b,f){return b.getParam(f,x[f])}var t=tinymce.each,u=null,x={paste_auto_cleanup_on_paste:true,paste_block_drop:false,paste_retain_style_properties:"none",paste_strip_class_attributes:"mso",paste_remove_spans:false,paste_remove_styles:false,paste_remove_styles_if_webkit:true,paste_convert_middot_lists:true,paste_convert_headers_to_strong:false,paste_dialog_width:"450",paste_dialog_height:"400",paste_text_use_dialog:false,paste_text_sticky:false,paste_text_notifyalways:false,paste_text_linebreaktype:"p",
paste_text_replacements:[[/\u2026/g,"..."],[/[\x93\x94\u201c\u201d]/g,'"'],[/[\x60\x91\x92\u2018\u2019]/g,"'"]]};tinymce.create("tinymce.plugins.PastePlugin",{init:function(b,f){function d(c,e){var l=b.dom;a.onPreProcess.dispatch(a,c);c.node=l.create("div",0,c.content);a.onPostProcess.dispatch(a,c);c.content=b.serializer.serialize(c.node,{getInner:1});if(!e&&b.pasteAsPlainText){a._insertPlainText(b,l,c.content);if(!p(b,"paste_text_sticky")){b.pasteAsPlainText=false;b.controlManager.setActive("pastetext",
false)}}else/<(p|h[1-6]|ul|ol)/.test(c.content)?a._insertBlockContent(b,l,c.content):a._insert(c.content)}function h(c){var e,l,g,n=b.selection,i=b.dom;g=b.getBody();if(b.pasteAsPlainText&&(c.clipboardData||i.doc.dataTransfer)){c.preventDefault();d({content:(c.clipboardData||i.doc.dataTransfer).getData("Text")},true)}else if(!i.get("_mcePaste")){e=i.add(g,"div",{id:"_mcePaste","class":"mcePaste"},"\ufeff");g=g!=b.getDoc().body?i.getPos(b.selection.getStart(),g).y:g.scrollTop;i.setStyles(e,{position:"absolute",
left:-1E4,top:g,width:1,height:1,overflow:"hidden"});if(tinymce.isIE){g=i.doc.body.createTextRange();g.moveToElementText(e);g.execCommand("Paste");i.remove(e);if(e.innerHTML==="\ufeff"){b.execCommand("mcePasteWord");c.preventDefault()}else{d({content:e.innerHTML});return tinymce.dom.Event.cancel(c)}}else{var k=function(q){q.preventDefault()};i.bind(b.getDoc(),"mousedown",k);i.bind(b.getDoc(),"keydown",k);l=b.selection.getRng();e=e.firstChild;g=b.getDoc().createRange();g.setStart(e,0);g.setEnd(e,1);
n.setRng(g);window.setTimeout(function(){var q="",j=i.select("div.mcePaste");t(j,function(o){t(i.select("div.mcePaste",o),function(m){i.remove(m,1)});t(i.select("span.Apple-style-span",o),function(m){i.remove(m,1)});q+=o.innerHTML});t(j,function(o){i.remove(o)});l&&n.setRng(l);d({content:q});i.unbind(b.getDoc(),"mousedown",k);i.unbind(b.getDoc(),"keydown",k)},0)}}}var a=this;a.editor=b;a.url=f;a.onPreProcess=new tinymce.util.Dispatcher(a);a.onPostProcess=new tinymce.util.Dispatcher(a);a.onPreProcess.add(a._preProcess);
a.onPostProcess.add(a._postProcess);a.onPreProcess.add(function(c,e){b.execCallback("paste_preprocess",c,e)});a.onPostProcess.add(function(c,e){b.execCallback("paste_postprocess",c,e)});b.pasteAsPlainText=false;b.addCommand("mceInsertClipboardContent",function(c,e){d(e,true)});p(b,"paste_text_use_dialog")||b.addCommand("mcePasteText",function(){var c=tinymce.util.Cookie;b.pasteAsPlainText=!b.pasteAsPlainText;b.controlManager.setActive("pastetext",b.pasteAsPlainText);if(b.pasteAsPlainText&&!c.get("tinymcePasteText")){p(b,
"paste_text_sticky");b.windowManager.alert(b.translate("paste.plaintext_mode_sticky"));p(b,"paste_text_notifyalways")||c.set("tinymcePasteText","1",new Date((new Date).getFullYear()+1,12,31))}});b.addButton("pastetext",{title:"paste.paste_text_desc",cmd:"mcePasteText"});b.addButton("selectall",{title:"paste.selectall_desc",cmd:"selectall"});if(p(b,"paste_auto_cleanup_on_paste"))tinymce.isOpera||/Firefox\/2/.test(navigator.userAgent)?b.onKeyDown.add(function(c,e){if((tinymce.isMac?e.metaKey:e.ctrlKey)&&
e.keyCode==86||e.shiftKey&&e.keyCode==45)h(e)}):b.onPaste.addToTop(function(c,e){return h(e)});p(b,"paste_block_drop")&&b.onInit.add(function(){b.dom.bind(b.getBody(),["dragend","dragover","draggesture","dragdrop","drop","drag"],function(c){c.preventDefault();c.stopPropagation();return false})});a._legacySupport()},getInfo:function(){return{longname:"Paste text/word",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/paste",
version:tinymce.majorVersion+"."+tinymce.minorVersion}},_preProcess:function(b,f){function d(i){t(i,function(k){a=k.constructor==RegExp?a.replace(k,""):a.replace(k[0],k[1])})}var h=this.editor,a=f.content,c=tinymce.grep,e=tinymce.explode,l=tinymce.trim,g,n;if(/class="?Mso|style="[^"]*\bmso-|w:WordDocument/i.test(a)||f.wordContent){f.wordContent=true;d([/^\s*(&nbsp;)+/gi,/(&nbsp;|<br[^>]*>)+\s*$/gi]);if(p(h,"paste_convert_headers_to_strong"))a=a.replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,
"<p><strong>$1</strong></p>");p(h,"paste_convert_middot_lists")&&d([[/<!--\[if !supportLists\]--\>/gi,"$&__MCE_ITEM__"],[/(<span[^>]+(?:mso-list:|:\s*symbol)[^>]+>)/gi,"$1__MCE_ITEM__"]]);d([/<!--[\s\S]+?--\>/gi,/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,[/<(\/?)s>/gi,"<$1strike>"],[/&nbsp;/gi,"\u00a0"]]);do{g=a.length;a=a.replace(/(<[a-z][^>]*\s)(?:id|name|language|type|on\w+|\w+:\w+)=(?:"[^"]*"|\w+)\s?/gi,"$1")}while(g!=a.length);if(p(h,
"paste_retain_style_properties").replace(/^none$/i,"").length==0)a=a.replace(/<\/?span[^>]*>/gi,"");else d([[/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,function(i,k){return k.length>0?k.replace(/./," ").slice(Math.floor(k.length/2)).split("").join("\u00a0"):""}],[/(<[a-z][^>]*)\sstyle="([^"]*)"/gi,function(i,k,q){var j=[],o=0;i=e(l(q).replace(/&quot;/gi,"'"),";");t(i,function(m){function r(w){return w+(w!=="0"&&/\d$/.test(w))?"px":""}var s,v=e(m,":");if(v.length==
2){m=v[0].toLowerCase();s=v[1].toLowerCase();switch(m){case "mso-padding-alt":case "mso-padding-top-alt":case "mso-padding-right-alt":case "mso-padding-bottom-alt":case "mso-padding-left-alt":case "mso-margin-alt":case "mso-margin-top-alt":case "mso-margin-right-alt":case "mso-margin-bottom-alt":case "mso-margin-left-alt":case "mso-table-layout-alt":case "mso-height":case "mso-width":case "mso-vertical-align-alt":j[o++]=m.replace(/^mso-|-alt$/g,"")+":"+r(s);return;case "horiz-align":j[o++]="text-align:"+
s;return;case "vert-align":j[o++]="vertical-align:"+s;return;case "font-color":case "mso-foreground":j[o++]="color:"+s;return;case "mso-background":case "mso-highlight":j[o++]="background:"+s;return;case "mso-default-height":j[o++]="min-height:"+r(s);return;case "mso-default-width":j[o++]="min-width:"+r(s);return;case "mso-padding-between-alt":j[o++]="border-collapse:separate;border-spacing:"+r(s);return;case "text-line-through":if(s=="single"||s=="double")j[o++]="text-decoration:line-through";return;
case "mso-zero-height":if(s=="yes")j[o++]="display:none";return}/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?!align|decor|indent|trans)|top-bar|version|vnd|word-break)/.test(m)||(j[o++]=m+":"+v[1])}});return o>0?k+' style="'+j.join(";")+'"':k}]])}p(h,"paste_convert_headers_to_strong")&&d([[/<h[1-6][^>]*>/gi,"<p><strong>"],[/<\/h[1-6][^>]*>/gi,"</strong></p>"]]);n=p(h,"paste_strip_class_attributes");if(n!=="none"){g=function(i,
k){if(n==="all")return"";var q=c(e(k.replace(/^(["'])(.*)\1$/,"$2")," "),function(j){return/^(?!mso)/i.test(j)});return q.length?' class="'+q.join(" ")+'"':""};a=a.replace(/ class="([^"]+)"/gi,g);a=a.replace(/ class=(\w+)/gi,g)}if(p(h,"paste_remove_spans"))a=a.replace(/<\/?span[^>]*>/gi,"");f.content=a},_postProcess:function(b,f){var d=this.editor,h=d.dom,a;if(f.wordContent){t(h.select("a",f.node),function(c){if(!c.href||c.href.indexOf("#_Toc")!=-1)h.remove(c,1)});p(d,"paste_convert_middot_lists")&&
this._convertLists(b,f);a=p(d,"paste_retain_style_properties");if(tinymce.is(a,"string")&&a!=="all"&&a!=="*"){a=tinymce.explode(a.replace(/^none$/i,""));t(h.select("*",f.node),function(c){var e={},l=0,g,n,i;if(a)for(g=0;g<a.length;g++){n=a[g];if(i=h.getStyle(c,n)){e[n]=i;l++}}h.setAttrib(c,"style","");if(a&&l>0)h.setStyles(c,e);else c.nodeName=="SPAN"&&!c.className&&h.remove(c,true)})}}if(p(d,"paste_remove_styles")||p(d,"paste_remove_styles_if_webkit")&&tinymce.isWebKit)t(h.select("*[style]",f.node),
function(c){c.removeAttribute("style");c.removeAttribute("_mce_style")});else tinymce.isWebKit&&t(h.select("*",f.node),function(c){c.removeAttribute("_mce_style")})},_convertLists:function(b,f){var d=b.editor.dom,h,a,c=-1,e,l=[],g,n;t(d.select("p",f.node),function(i){var k,q="",j;for(k=i.firstChild;k&&k.nodeType==3;k=k.nextSibling)q+=k.nodeValue;q=i.innerHTML.replace(/<\/?\w+[^>]*>/gi,"").replace(/&nbsp;/g,"\u00a0");if(/^(__MCE_ITEM__)+[\u2022\u00b7\u00a7\u00d8o]\s*\u00a0*/.test(q))j="ul";if(/^__MCE_ITEM__\s*\w+\.\s*\u00a0{2,}/.test(q))j=
"ol";if(j){e=parseFloat(i.style.marginLeft||0);e>c&&l.push(e);if(!h||j!=g){h=d.create(j);d.insertAfter(h,i)}else if(e>c)h=a.appendChild(d.create(j));else if(e<c){k=tinymce.inArray(l,e);q=d.getParents(h.parentNode,j);h=q[q.length-1-k]||h}t(d.select("span",i),function(o){var m=o.innerHTML.replace(/<\/?\w+[^>]*>/gi,"");if(j=="ul"&&/^[\u2022\u00b7\u00a7\u00d8o]/.test(m))d.remove(o);else/^[\s\S]*\w+\.(&nbsp;|\u00a0)*\s*/.test(m)&&d.remove(o)});k=i.innerHTML;k=j=="ul"?i.innerHTML.replace(/__MCE_ITEM__/g,
"").replace(/^[\u2022\u00b7\u00a7\u00d8o]\s*(&nbsp;|\u00a0)+\s*/,""):i.innerHTML.replace(/__MCE_ITEM__/g,"").replace(/^\s*\w+\.(&nbsp;|\u00a0)+\s*/,"");a=h.appendChild(d.create("li",0,k));d.remove(i);c=e;g=j}else h=c=0});n=f.node.innerHTML;if(n.indexOf("__MCE_ITEM__")!=-1)f.node.innerHTML=n.replace(/__MCE_ITEM__/g,"")},_insertBlockContent:function(b,f,d){function h(g){var n;if(tinymce.isIE){n=b.getDoc().body.createTextRange();n.moveToElementText(g);n.collapse(false);n.select()}else{e.select(g,1);
e.collapse(false)}}var a,c,e=b.selection,l;this._insert('<span id="mce_marker">&nbsp;</span>',1);c=f.get("mce_marker");if((a=f.getParent(c,"p,h1,h2,h3,h4,h5,h6,ul,ol,th,td"))&&!/TD|TH/.test(a.nodeName)){c=f.split(a,c);t(f.create("div",0,d).childNodes,function(g){l=c.parentNode.insertBefore(g.cloneNode(true),c)});h(l)}else{f.setOuterHTML(c,d);e.select(b.getBody(),1);e.collapse(0)}for(;d=f.get("mce_marker");)f.remove(d);d=e.getStart();f=f.getViewPort(b.getWin());a=b.dom.getPos(d).y;d=d.clientHeight;
if(a<f.y||a+d>f.y+f.h)b.getDoc().body.scrollTop=a<f.y?a:a-f.h+25},_insert:function(b,f){var d=this.editor,h=d.selection.getRng();!d.selection.isCollapsed()&&h.startContainer!=h.endContainer&&d.getDoc().execCommand("Delete",false,null);d.execCommand(tinymce.isGecko?"insertHTML":"mceInsertContent",false,b,{skip_undo:f})},_insertPlainText:function(b,f,d){function h(m){t(m,function(r){d=r.constructor==RegExp?d.replace(r,""):d.replace(r[0],r[1])})}var a,c,e,l,g,n,i,k=b.getWin(),q=b.getDoc(),j=b.selection;
e=tinymce.is;var o=tinymce.inArray;l=p(b,"paste_text_linebreaktype");g=p(b,"paste_text_replacements");if(typeof d==="string"&&d.length>0){u||(u=("34,quot,38,amp,39,apos,60,lt,62,gt,"+b.serializer.settings.entities).split(","));/<(?:p|br|h[1-6]|ul|ol|dl|table|t[rdh]|div|blockquote|fieldset|pre|address|center)[^>]*>/i.test(d)?h([/[\n\r]+/g]):h([/\r+/g]);h([[/<\/(?:p|h[1-6]|ul|ol|dl|table|div|blockquote|fieldset|pre|address|center)>/gi,"\n\n"],[/<br[^>]*>|<\/tr>/gi,"\n"],[/<\/t[dh]>\s*<t[dh][^>]*>/gi,
"\t"],/<[a-z!\/?][^>]*>/gi,[/&nbsp;/gi," "],[/&(#\d+|[a-z0-9]{1,10});/gi,function(m,r){return r.charAt(0)==="#"?String.fromCharCode(r.slice(1)):(m=o(u,r))>0?String.fromCharCode(u[m-1]):" "}],[/(?:(?!\n)\s)*(\n+)(?:(?!\n)\s)*/gi,"$1"],[/\n{3,}/g,"\n\n"],/^\s+|\s+$/g]);d=f.encode(d);j.isCollapsed()||q.execCommand("Delete",false,null);if(e(g,"array")||e(g,"array"))h(g);else e(g,"string")&&h(RegExp(g,"gi"));if(l=="none")h([[/\n+/g," "]]);else l=="br"?h([[/\n/g,"<br />"]]):h([/^\s+|\s+$/g,[/\n\n/g,"</p><p>"],
[/\n/g,"<br />"]]);if((e=d.indexOf("</p><p>"))!=-1){l=d.lastIndexOf("</p><p>");a=j.getNode();g=[];do if(a.nodeType==1){if(a.nodeName=="TD"||a.nodeName=="BODY")break;g[g.length]=a}while(a=a.parentNode);if(g.length>0){n=d.substring(0,e);i="";a=0;for(c=g.length;a<c;a++){n+="</"+g[a].nodeName.toLowerCase()+">";i+="<"+g[g.length-a-1].nodeName.toLowerCase()+">"}d=e==l?n+i+d.substring(e+7):n+d.substring(e+4,l+4)+i+d.substring(l+7)}}b.execCommand("mceInsertRawHTML",false,d+'<span id="_plain_text_marker">&nbsp;</span>');
window.setTimeout(function(){var m=f.get("_plain_text_marker"),r,s;j.select(m,false);q.execCommand("Delete",false,null);r=j.getStart();m=f.getViewPort(k);s=f.getPos(r).y;r=r.clientHeight;if(s<m.y||s+r>m.y+m.h)q.body.scrollTop=s<m.y?s:s-m.h+25},0)}},_legacySupport:function(){var b=this,f=b.editor;f.addCommand("mcePasteWord",function(){f.windowManager.open({file:b.url+"/pasteword.htm",width:parseInt(p(f,"paste_dialog_width")),height:parseInt(p(f,"paste_dialog_height")),inline:1})});p(f,"paste_text_use_dialog")&&
f.addCommand("mcePasteText",function(){f.windowManager.open({file:b.url+"/pastetext.htm",width:parseInt(p(f,"paste_dialog_width")),height:parseInt(p(f,"paste_dialog_height")),inline:1})});f.addButton("pasteword",{title:"paste.paste_word_desc",cmd:"mcePasteWord"})}});tinymce.PluginManager.add("paste",tinymce.plugins.PastePlugin)})();
