(function(){var k=tinymce.each;tinymce.create("tinymce.plugins.MediaPlugin",{init:function(b,d){function g(h){return/^(mceItemFlash|mceItemShockWave|mceItemWindowsMedia|mceItemQuickTime|mceItemRealMedia)$/.test(h.className)}function c(h,e){return(e=RegExp(e+'="([^"]+)"',"g").exec(h))?b.dom.decode(e[1]):""}var a=this;a.editor=b;a.url=d;b.onPreInit.add(function(){b.serializer.addRules("param[name|value|_mce_value]")});b.addCommand("mceMedia",function(){b.windowManager.open({file:d+"/media.htm",width:430+
parseInt(b.getLang("media.delta_width",0)),height:470+parseInt(b.getLang("media.delta_height",0)),inline:1},{plugin_url:d})});b.addButton("media",{title:"media.desc",cmd:"mceMedia"});b.onNodeChange.add(function(h,e,f){e.setActive("media",f.nodeName=="IMG"&&g(f))});b.onInit.add(function(){var h={mceItemFlash:"flash",mceItemShockWave:"shockwave",mceItemWindowsMedia:"windowsmedia",mceItemQuickTime:"quicktime",mceItemRealMedia:"realmedia"};b.selection.onSetContent.add(function(){a._spansToImgs(b.getBody())});
b.selection.onBeforeSetContent.add(a._objectsToSpans,a);b.settings.content_css!==false&&b.dom.loadCSS(d+"/css/content.css");b.theme&&b.theme.onResolveName&&b.theme.onResolveName.add(function(e,f){f.name=="img"&&k(h,function(i,j){if(b.dom.hasClass(f.node,j)){f.name=i;f.title=b.dom.getAttrib(f.node,"title");return false}})});b&&b.plugins.contextmenu&&b.plugins.contextmenu.onContextMenu.add(function(e,f,i){i.nodeName=="IMG"&&/mceItem(Flash|ShockWave|WindowsMedia|QuickTime|RealMedia)/.test(i.className)&&
f.add({title:"media.edit",icon:"media",cmd:"mceMedia"})})});b.onBeforeSetContent.add(a._objectsToSpans,a);b.onSetContent.add(function(){a._spansToImgs(b.getBody())});b.onPreProcess.add(function(h,e){var f=h.dom;if(e.set){a._spansToImgs(e.node);k(f.select("IMG",e.node),function(i){var j;if(g(i)){j=a._parse(i.title);f.setAttrib(i,"width",f.getAttrib(i,"width",j.width||100));f.setAttrib(i,"height",f.getAttrib(i,"height",j.height||100))}})}e.get&&k(f.select("IMG",e.node),function(i){var j,l,m;if(h.getParam("media_use_script")){if(g(i))i.className=
i.className.replace(/mceItem/g,"mceTemp")}else{switch(i.className){case "mceItemFlash":j="d27cdb6e-ae6d-11cf-96b8-444553540000";l="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0";m="application/x-shockwave-flash";break;case "mceItemShockWave":j="166b1bca-3f9c-11cf-8075-444553540000";l="http://download.macromedia.com/pub/shockwave/cabs/director/sw.cab#version=8,5,1,0";m="application/x-director";break;case "mceItemWindowsMedia":j=h.getParam("media_wmp6_compatible")?
"05589fa1-c356-11ce-bf01-00aa0055595a":"6bf52a52-394a-11d3-b153-00c04f79faa6";l="http://activex.microsoft.com/activex/controls/mplayer/en/nsmp2inf.cab#Version=5,1,52,701";m="application/x-mplayer2";break;case "mceItemQuickTime":j="02bf25d5-8c17-4b23-bc80-d3488abddc6b";l="http://www.apple.com/qtactivex/qtplugin.cab#version=6,0,2,0";m="video/quicktime";break;case "mceItemRealMedia":j="cfcdaa03-8be4-11cf-b84b-0020afbbccfa";l="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0";
m="audio/x-pn-realaudio-plugin"}j&&f.replace(a._buildObj({classid:j,codebase:l,type:m},i),i)}})});b.onPostProcess.add(function(h,e){e.content=e.content.replace(/_mce_value=/g,"value=")});b.onPostProcess.add(function(h,e){if(h.getParam("media_use_script"))e.content=e.content.replace(/<img[^>]+>/g,function(f){var i=c(f,"class");if(/^(mceTempFlash|mceTempShockWave|mceTempWindowsMedia|mceTempQuickTime|mceTempRealMedia)$/.test(i)){at=a._parse(c(f,"title"));at.width=c(f,"width");at.height=c(f,"height");
f='<script type="text/javascript">write'+i.substring(7)+"({"+a._serialize(at)+"});<\/script>"}return f})})},getInfo:function(){return{longname:"Media",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/media",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_objectsToSpans:function(b,d){var g=this,c=d.content;c=c.replace(/<script[^>]*>\s*write(Flash|ShockWave|WindowsMedia|QuickTime|RealMedia)\(\{([^\)]*)\}\);\s*<\/script>/gi,
function(a,h,e){a=g._parse(e);return'<img class="mceItem'+h+'" title="'+b.dom.encode(e)+'" src="'+g.url+'/img/trans.gif" width="'+a.width+'" height="'+a.height+'" />'});c=c.replace(/<object([^>]*)>/gi,'<span class="mceItemObject" $1>');c=c.replace(/<embed([^>]*)\/?>/gi,'<span class="mceItemEmbed" $1></span>');c=c.replace(/<embed([^>]*)>/gi,'<span class="mceItemEmbed" $1>');c=c.replace(/<\/(object)([^>]*)>/gi,"</span>");c=c.replace(/<\/embed>/gi,"");c=c.replace(/<param([^>]*)>/gi,function(a,h){return"<span "+
h.replace(/value=/gi,"_mce_value=")+' class="mceItemParam"></span>'});c=c.replace(/\/ class=\"mceItemParam\"><\/span>/gi,'class="mceItemParam"></span>');d.content=c},_buildObj:function(b,d){var g,c=this.editor,a=c.dom,h=this._parse(d.title),e;e=c.getParam("media_strict",true)&&b.type=="application/x-shockwave-flash";h.width=b.width=a.getAttrib(d,"width")||100;h.height=b.height=a.getAttrib(d,"height")||100;if(h.src)h.src=c.convertURL(h.src,"src",d);g=e?a.create("span",{id:h.id,_mce_name:"object",type:"application/x-shockwave-flash",
data:h.src,style:a.getAttrib(d,"style"),width:b.width,height:b.height}):a.create("span",{id:h.id,_mce_name:"object",classid:"clsid:"+b.classid,style:a.getAttrib(d,"style"),codebase:b.codebase,width:b.width,height:b.height});k(h,function(f,i){if(!/^(width|height|codebase|classid|id|_cx|_cy)$/.test(i)){if(b.type=="application/x-mplayer2"&&i=="src"&&!h.url)i="url";f&&a.add(g,"span",{_mce_name:"param",name:i,_mce_value:f})}});e||a.add(g,"span",tinymce.extend({_mce_name:"embed",type:b.type,style:a.getAttrib(d,
"style")},h));return g},_spansToImgs:function(b){var d=this,g=d.editor.dom,c;k(g.select("span",b),function(a){if(g.getAttrib(a,"class")=="mceItemObject"){c=g.getAttrib(a,"classid").toLowerCase().replace(/\s+/g,"");switch(c){case "clsid:d27cdb6e-ae6d-11cf-96b8-444553540000":g.replace(d._createImg("mceItemFlash",a),a);break;case "clsid:166b1bca-3f9c-11cf-8075-444553540000":g.replace(d._createImg("mceItemShockWave",a),a);break;case "clsid:6bf52a52-394a-11d3-b153-00c04f79faa6":case "clsid:22d6f312-b0f6-11d0-94ab-0080c74c7e95":case "clsid:05589fa1-c356-11ce-bf01-00aa0055595a":g.replace(d._createImg("mceItemWindowsMedia",
a),a);break;case "clsid:02bf25d5-8c17-4b23-bc80-d3488abddc6b":g.replace(d._createImg("mceItemQuickTime",a),a);break;case "clsid:cfcdaa03-8be4-11cf-b84b-0020afbbccfa":g.replace(d._createImg("mceItemRealMedia",a),a);break;default:g.replace(d._createImg("mceItemFlash",a),a)}}else if(g.getAttrib(a,"class")=="mceItemEmbed")switch(g.getAttrib(a,"type")){case "application/x-shockwave-flash":g.replace(d._createImg("mceItemFlash",a),a);break;case "application/x-director":g.replace(d._createImg("mceItemShockWave",
a),a);break;case "application/x-mplayer2":g.replace(d._createImg("mceItemWindowsMedia",a),a);break;case "video/quicktime":g.replace(d._createImg("mceItemQuickTime",a),a);break;case "audio/x-pn-realaudio-plugin":g.replace(d._createImg("mceItemRealMedia",a),a);break;default:g.replace(d._createImg("mceItemFlash",a),a)}})},_createImg:function(b,d){var g,c=this.editor.dom,a={},h;h=["id","name","width","height","bgcolor","align","flashvars","src","wmode","allowfullscreen","quality","data"];g=c.create("img",
{src:this.url+"/img/trans.gif",width:c.getAttrib(d,"width")||100,height:c.getAttrib(d,"height")||100,style:c.getAttrib(d,"style"),"class":b});k(h,function(e){var f=c.getAttrib(d,e);if(f)a[e]=f});k(c.select("span",d),function(e){if(c.hasClass(e,"mceItemParam"))a[c.getAttrib(e,"name")]=c.getAttrib(e,"_mce_value")});if(a.movie){a.src=a.movie;delete a.movie}if(!a.src){a.src=a.data;delete a.data}(d=c.select(".mceItemEmbed",d)[0])&&k(h,function(e){var f=c.getAttrib(d,e);if(f&&!a[e])a[e]=f});delete a.width;
delete a.height;g.title=this._serialize(a);return g},_parse:function(b){return tinymce.util.JSON.parse("{"+b+"}")},_serialize:function(b){return tinymce.util.JSON.serialize(b).replace(/[{}]/g,"")}});tinymce.PluginManager.add("media",tinymce.plugins.MediaPlugin)})();
