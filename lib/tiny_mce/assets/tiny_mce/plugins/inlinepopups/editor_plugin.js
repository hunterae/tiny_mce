(function(){var e=tinymce.DOM,z=tinymce.dom.Element,n=tinymce.dom.Event,A=tinymce.each,F=tinymce.is;tinymce.create("tinymce.plugins.InlinePopups",{init:function(a,d){a.onBeforeRenderUI.add(function(){a.windowManager=new tinymce.InlineWindowManager(a);e.loadCSS(d+"/skins/"+(a.settings.inlinepopups_skin||"clearlooks2")+"/window.css")})},getInfo:function(){return{longname:"InlinePopups",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/inlinepopups",
version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.create("tinymce.InlineWindowManager:tinymce.WindowManager",{InlineWindowManager:function(a){this.parent(a);this.zIndex=3E5;this.count=0;this.windows={}},open:function(a,d){var b=this,c,f="",q=b.editor,r=0,t=0,j,u;a=a||{};d=d||{};if(!a.inline)return b.parent(a,d);if(!a.type)b.bookmark=q.selection.getBookmark(1);c=e.uniqueId();j=e.getViewPort();a.width=parseInt(a.width||320);a.height=parseInt(a.height||240)+(tinymce.isIE?8:0);a.min_width=
parseInt(a.min_width||150);a.min_height=parseInt(a.min_height||100);a.max_width=parseInt(a.max_width||2E3);a.max_height=parseInt(a.max_height||2E3);a.left=a.left||Math.round(Math.max(j.x,j.x+j.w/2-a.width/2));a.top=a.top||Math.round(Math.max(j.y,j.y+j.h/2-a.height/2));a.movable=a.resizable=true;d.mce_width=a.width;d.mce_height=a.height;d.mce_inline=true;d.mce_window_id=c;d.mce_auto_focus=a.auto_focus;b.features=a;b.params=d;b.onOpen.dispatch(b,a,d);if(a.type){f+=" mceModal";if(a.type)f+=" mce"+a.type.substring(0,
1).toUpperCase()+a.type.substring(1);a.resizable=false}if(a.statusbar)f+=" mceStatusbar";if(a.resizable)f+=" mceResizable";if(a.minimizable)f+=" mceMinimizable";if(a.maximizable)f+=" mceMaximizable";if(a.movable)f+=" mceMovable";b._addAll(e.doc.body,["div",{id:c,"class":(q.settings.inlinepopups_skin||"clearlooks2")+(tinymce.isIE&&window.getSelection?" ie9":""),style:"width:100px;height:100px"},["div",{id:c+"_wrapper","class":"mceWrapper"+f},["div",{id:c+"_top","class":"mceTop"},["div",{"class":"mceLeft"}],
["div",{"class":"mceCenter"}],["div",{"class":"mceRight"}],["span",{id:c+"_title"},a.title||""]],["div",{id:c+"_middle","class":"mceMiddle"},["div",{id:c+"_left","class":"mceLeft"}],["span",{id:c+"_content"}],["div",{id:c+"_right","class":"mceRight"}]],["div",{id:c+"_bottom","class":"mceBottom"},["div",{"class":"mceLeft"}],["div",{"class":"mceCenter"}],["div",{"class":"mceRight"}],["span",{id:c+"_status"},"Content"]],["a",{"class":"mceMove",tabindex:"-1",href:"javascript:;"}],["a",{"class":"mceMin",
tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceMax",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceMed",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceClose",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{id:c+"_resize_n","class":"mceResize mceResizeN",tabindex:"-1",href:"javascript:;"}],["a",{id:c+"_resize_s","class":"mceResize mceResizeS",tabindex:"-1",href:"javascript:;"}],
["a",{id:c+"_resize_w","class":"mceResize mceResizeW",tabindex:"-1",href:"javascript:;"}],["a",{id:c+"_resize_e","class":"mceResize mceResizeE",tabindex:"-1",href:"javascript:;"}],["a",{id:c+"_resize_nw","class":"mceResize mceResizeNW",tabindex:"-1",href:"javascript:;"}],["a",{id:c+"_resize_ne","class":"mceResize mceResizeNE",tabindex:"-1",href:"javascript:;"}],["a",{id:c+"_resize_sw","class":"mceResize mceResizeSW",tabindex:"-1",href:"javascript:;"}],["a",{id:c+"_resize_se","class":"mceResize mceResizeSE",
tabindex:"-1",href:"javascript:;"}]]]);e.setStyles(c,{top:-1E4,left:-1E4});tinymce.isGecko&&e.setStyle(c,"overflow","auto");if(!a.type){r+=e.get(c+"_left").clientWidth;r+=e.get(c+"_right").clientWidth;t+=e.get(c+"_top").clientHeight;t+=e.get(c+"_bottom").clientHeight}e.setStyles(c,{top:a.top,left:a.left,width:a.width+r,height:a.height+t});if(f=a.url||a.file){if(tinymce.relaxedDomain)f+=(f.indexOf("?")==-1?"?":"&")+"mce_rdomain="+tinymce.relaxedDomain;f=tinymce._addVer(f)}if(a.type){e.add(c+"_wrapper",
"a",{id:c+"_ok","class":"mceButton mceOk",href:"javascript:;",onmousedown:"return false;"},"Ok");a.type=="confirm"&&e.add(c+"_wrapper","a",{"class":"mceButton mceCancel",href:"javascript:;",onmousedown:"return false;"},"Cancel");e.add(c+"_middle","div",{"class":"mceIcon"});e.setHTML(c+"_content",a.content.replace("\n","<br />"))}else{e.add(c+"_content","iframe",{id:c+"_ifr",src:'javascript:""',frameBorder:0,style:"border:0;width:10px;height:10px"});e.setStyles(c+"_ifr",{width:a.width,height:a.height});
e.setAttrib(c+"_ifr","src",f)}f=n.add(c,"mousedown",function(h){var k=h.target,g;g=b.windows[c];b.focus(c);if(k.nodeName=="A"||k.nodeName=="a")if(k.className=="mceMax"){g.oldPos=g.element.getXY();g.oldSize=g.element.getSize();h=e.getViewPort();h.w-=2;h.h-=2;g.element.moveTo(h.x,h.y);g.element.resizeTo(h.w,h.h);e.setStyles(c+"_ifr",{width:h.w-g.deltaWidth,height:h.h-g.deltaHeight});e.addClass(c+"_wrapper","mceMaximized")}else if(k.className=="mceMed"){g.element.moveTo(g.oldPos.x,g.oldPos.y);g.element.resizeTo(g.oldSize.w,
g.oldSize.h);g.iframeElement.resizeTo(g.oldSize.w-g.deltaWidth,g.oldSize.h-g.deltaHeight);e.removeClass(c+"_wrapper","mceMaximized")}else if(k.className=="mceMove")return b._startDrag(c,h,k.className);else if(e.hasClass(k,"mceResize"))return b._startDrag(c,h,k.className.substring(13))});u=n.add(c,"click",function(h){var k=h.target;b.focus(c);if(k.nodeName=="A"||k.nodeName=="a")switch(k.className){case "mceClose":b.close(null,c);return n.cancel(h);case "mceButton mceOk":case "mceButton mceCancel":a.button_func(k.className==
"mceButton mceOk");return n.cancel(h)}});q=b.windows[c]={id:c,mousedown_func:f,click_func:u,element:new z(c,{blocker:1,container:q.getContainer()}),iframeElement:new z(c+"_ifr"),features:a,deltaWidth:r,deltaHeight:t};q.iframeElement.on("focus",function(){b.focus(c)});if(b.count==0&&b.editor.getParam("dialog_type","modal")=="modal"){e.add(e.doc.body,"div",{id:"mceModalBlocker","class":(b.editor.settings.inlinepopups_skin||"clearlooks2")+"_modalBlocker",style:{zIndex:b.zIndex-1}});e.show("mceModalBlocker")}else e.setStyle("mceModalBlocker",
"z-index",b.zIndex-1);if(tinymce.isIE6||/Firefox\/2\./.test(navigator.userAgent)||tinymce.isIE&&!e.boxModel)e.setStyles("mceModalBlocker",{position:"absolute",left:j.x,top:j.y,width:j.w-2,height:j.h-2});b.focus(c);b._fixIELayout(c,1);e.get(c+"_ok")&&e.get(c+"_ok").focus();b.count++;return q},focus:function(a){var d;if(d=this.windows[a]){d.zIndex=this.zIndex++;d.element.setStyle("zIndex",d.zIndex);d.element.update();a+="_wrapper";e.removeClass(this.lastId,"mceFocus");e.addClass(a,"mceFocus");this.lastId=
a}},_addAll:function(a,d){var b;b=tinymce.DOM;if(F(d,"string"))a.appendChild(b.doc.createTextNode(d));else if(d.length){a=a.appendChild(b.create(d[0],d[1]));for(b=2;b<d.length;b++)this._addAll(a,d[b])}},_startDrag:function(a,d,b){function c(){if(!j){f._fixIELayout(a,0);e.add(t.body,"div",{id:"mceEventBlocker","class":"mceEventBlocker "+(f.editor.settings.inlinepopups_skin||"clearlooks2"),style:{zIndex:f.zIndex+1}});if(tinymce.isIE6||tinymce.isIE&&!e.boxModel)e.setStyles("mceEventBlocker",{position:"absolute",
left:i.x,top:i.y,width:i.w-2,height:i.h-2});j=new z("mceEventBlocker");j.update();k=h.getXY();g=h.getSize();v=B.x+k.x-i.x;w=B.y+k.y-i.y;e.add(j.get(),"div",{id:"mcePlaceHolder","class":"mcePlaceHolder",style:{left:v,top:w,width:g.w,height:g.h}});C=new z("mcePlaceHolder")}}var f=this,q,r,t=e.doc,j,u=f.windows[a],h=u.element;h.getXY();var k,g,C,B,i,v,w,D,E,m,p,o,s;B={x:0,y:0};i=e.getViewPort();i.w-=2;i.h-=2;D=d.screenX;E=d.screenY;m=p=o=s=0;q=n.add(t,"mouseup",function(x){n.remove(t,"mouseup",q);n.remove(t,
"mousemove",r);j&&j.remove();h.moveBy(m,p);h.resizeBy(o,s);g=h.getSize();e.setStyles(a+"_ifr",{width:g.w-u.deltaWidth,height:g.h-u.deltaHeight});f._fixIELayout(a,1);return n.cancel(x)});b!="Move"&&c();r=n.add(t,"mousemove",function(x){var l,y;c();l=x.screenX-D;y=x.screenY-E;switch(b){case "ResizeW":m=l;o=0-l;break;case "ResizeE":o=l;break;case "ResizeN":case "ResizeNW":case "ResizeNE":if(b=="ResizeNW"){m=l;o=0-l}else if(b=="ResizeNE")o=l;p=y;s=0-y;break;case "ResizeS":case "ResizeSW":case "ResizeSE":if(b==
"ResizeSW"){m=l;o=0-l}else if(b=="ResizeSE")o=l;s=y;break;case "mceMove":m=l;p=y}if(o<(l=u.features.min_width-g.w)){if(m!==0)m+=o-l;o=l}if(s<(l=u.features.min_height-g.h)){if(p!==0)p+=s-l;s=l}o=Math.min(o,u.features.max_width-g.w);s=Math.min(s,u.features.max_height-g.h);m=Math.max(m,i.x-(v+i.x));p=Math.max(p,i.y-(w+i.y));m=Math.min(m,i.w+i.x-(v+g.w+i.x));p=Math.min(p,i.h+i.y-(w+g.h+i.y));if(m+p!==0){if(v+m<0)m=0;if(w+p<0)p=0;C.moveTo(v+m,w+p)}o+s!==0&&C.resizeTo(g.w+o,g.h+s);return n.cancel(x)});
return n.cancel(d)},resizeBy:function(a,d,b){if(b=this.windows[b]){b.element.resizeBy(a,d);b.iframeElement.resizeBy(a,d)}},close:function(a,d){var b,c=e.doc,f=0,q;d=this._findId(d||a);if(this.windows[d]){this.count--;this.count==0&&e.remove("mceModalBlocker");if(b=this.windows[d]){this.onClose.dispatch(this);n.remove(c,"mousedown",b.mousedownFunc);n.remove(c,"click",b.clickFunc);n.clear(d);n.clear(d+"_ifr");e.setAttrib(d+"_ifr","src",'javascript:""');b.element.remove();delete this.windows[d];A(this.windows,
function(r){if(r.zIndex>f){q=r;f=r.zIndex}});q&&this.focus(q.id)}}else this.parent(a)},setTitle:function(a,d){var b;a=this._findId(a);if(b=e.get(a+"_title"))b.innerHTML=e.encode(d)},alert:function(a,d){var b=this,c;c=b.open({title:b,type:"alert",button_func:function(f){if(d)d.call(f||b,f);b.close(null,c.id)},content:e.encode(b.editor.getLang(a,a)),inline:1,width:400,height:130})},confirm:function(a,d){var b=this,c;c=b.open({title:b,type:"confirm",button_func:function(f){if(d)d.call(f||b,f);b.close(null,
c.id)},content:e.encode(b.editor.getLang(a,a)),inline:1,width:400,height:130})},_findId:function(a){if(typeof a=="string")return a;A(this.windows,function(d){var b=e.get(d.id+"_ifr");if(b&&a==b.contentWindow){a=d.id;return false}});return a},_fixIELayout:function(a,d){var b,c;if(tinymce.isIE6){A(["n","s","w","e","nw","ne","sw","se"],function(f){f=e.get(a+"_resize_"+f);e.setStyles(f,{width:d?f.clientWidth:"",height:d?f.clientHeight:"",cursor:e.getStyle(f,"cursor",1)});e.setStyle(a+"_bottom","bottom",
"-1px")});if(b=this.windows[a]){b.element.hide();b.element.show();A(e.select("div,a",a),function(f){if(f.currentStyle.backgroundImage!="none"){c=new Image;c.src=f.currentStyle.backgroundImage.replace(/url\(\"(.+)\"\)/,"$1")}});e.get(a).style.filter=""}}}});tinymce.PluginManager.add("inlinepopups",tinymce.plugins.InlinePopups)})();
